<!DOCTYPE html>
<!-- SPDX-License-Identifier: MIT -->
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Town Council Asset Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-color: #0f172a;
      color: #e2e8f0;
    }
    .card {
      background: linear-gradient(145deg, #1e293b, #0f172a);
      border: 1px solid #334155;
      color: #f8fafc;
    }
    .legend-circle { width: 14px; height: 14px; border-radius: 50%; }
    .sidebar { background-color: #1e293b; }
    select, option { background-color: #0f172a; color: #f8fafc; }
    .badge { background:#0b3b61; border:1px solid #1e40af; color:#c7d2fe; padding:2px 8px; border-radius:9999px; font-size:12px; }
  </style>
</head>
<body class="h-screen flex flex-col">
  <!-- KPI Cards -->
  <div class="grid grid-cols-4 gap-4 p-4 border-b border-slate-700 shadow-inner">
    <div class="card p-4 rounded-xl">
      <p class="text-sm text-slate-400">Total Blocks</p>
      <p class="text-3xl font-extrabold">800</p>
    </div>
    <div class="card p-4 rounded-xl">
      <p class="text-sm text-slate-400">Assets OK</p>
      <p class="text-3xl font-extrabold">6,200</p>
    </div>
    <div class="card p-4 rounded-xl">
      <p class="text-sm text-slate-400">Due for Maintenance</p>
      <p class="text-3xl font-extrabold">120</p>
    </div>
    <div class="card p-4 rounded-xl">
      <p class="text-sm text-slate-400">Faulty Assets</p>
      <p class="text-3xl font-extrabold">18</p>
    </div>
  </div>

  <div class="flex h-full">
    <!-- Sidebar -->
    <div class="w-96 sidebar border-r border-slate-700 overflow-y-auto">
      <div class="p-4 border-b border-slate-600">
        <h2 class="text-xl font-bold text-slate-100">Asset Summary</h2>
        <p class="text-sm text-slate-400">Click a block on the map to view asset details.</p>

        <!-- Filter by Asset Type -->
        <div class="mt-4">
          <label class="block text-sm font-medium mb-1 text-slate-300">Filter by Asset Type:</label>
          <select id="asset-filter" class="w-full border border-slate-500 rounded p-2">
            <option value="all">All</option>
            <option value="dry">Dry Riser</option>
            <option value="hose">Fire Hose Reel</option>
          </select>
        </div>

        <!-- Map Legend -->
        <div class="mt-6">
          <h3 class="text-sm font-medium text-slate-300 mb-2">Legend:</h3>
          <div class="space-y-2 text-sm">
            <div class="flex items-center gap-2"><span class="legend-circle bg-green-500"></span><span>All Assets OK</span></div>
            <div class="flex items-center gap-2"><span class="legend-circle bg-yellow-400"></span><span>Some Assets Due</span></div>
            <div class="flex items-center gap-2"><span class="legend-circle bg-red-500"></span><span>Faulty Assets Present</span></div>
          </div>
        </div>
      </div>
      <div id="block-info" class="p-4 space-y-2 text-sm">
        <!-- Dynamic block data goes here -->
      </div>
    </div>

    <!-- Map -->
    <div id="map" class="flex-1"></div>
  </div>

  <script>
    const map = L.map('map').setView([1.3521, 103.8198], 12); // Singapore center
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { attribution: '&copy; OpenStreetMap contributors' }).addTo(map);

    // Example block data (demo only)
    const blocks = [
      {
        id: "123A",
        lat: 1.3101, lng: 103.856,
        status: "ok",
        townCouncil: "Bishan–Toa Payoh Town Council",
        summary: { dry: 2, hose: 5, faulty: 0, due: 0 },
        assets: [
          { id: "DR-123A-01", type: "Dry Riser", location: "Stair 1", status: "OK", contractor: "ABC Fire Pte Ltd" },
          { id: "DR-123A-02", type: "Dry Riser", location: "Stair 2", status: "OK", contractor: "ABC Fire Pte Ltd" },
          { id: "FH-123A-01", type: "Fire Hose Reel", location: "L10 Lobby", status: "OK", contractor: "XYZ Safety Services" },
          { id: "FH-123A-02", type: "Fire Hose Reel", location: "L12 Lobby", status: "OK", contractor: "XYZ Safety Services" },
          { id: "FH-123A-03", type: "Fire Hose Reel", location: "L14 Lobby", status: "OK", contractor: "XYZ Safety Services" },
          { id: "FH-123A-04", type: "Fire Hose Reel", location: "L16 Lobby", status: "OK", contractor: "XYZ Safety Services" },
          { id: "FH-123A-05", type: "Fire Hose Reel", location: "L18 Lobby", status: "OK", contractor: "XYZ Safety Services" }
        ]
      },
      {
        id: "456B",
        lat: 1.3401, lng: 103.825,
        status: "warning",
        townCouncil: "Ang Mo Kio Town Council",
        summary: { dry: 1, hose: 5, faulty: 1, due: 1 },
        assets: [
          { id: "DR-456B-01", type: "Dry Riser", location: "Stair 1", status: "DUE", contractor: "Lion City Fire Systems" },
          { id: "FH-456B-01", type: "Fire Hose Reel", location: "L5 Lobby", status: "OK", contractor: "Lion City Fire Systems" },
          { id: "FH-456B-02", type: "Fire Hose Reel", location: "L8 Lobby", status: "OK", contractor: "Lion City Fire Systems" },
          { id: "FH-456B-03", type: "Fire Hose Reel", location: "L12 Lobby", status: "FAULTY", contractor: "Lion City Fire Systems" },
          { id: "FH-456B-04", type: "Fire Hose Reel", location: "L15 Lobby", status: "OK", contractor: "Lion City Fire Systems" },
          { id: "FH-456B-05", type: "Fire Hose Reel", location: "L18 Lobby", status: "OK", contractor: "Lion City Fire Systems" }
        ]
      },
      {
        id: "789C",
        lat: 1.3721, lng: 103.812,
        status: "faulty",
        townCouncil: "Jurong–Clementi Town Council",
        summary: { dry: 2, hose: 4, faulty: 2, due: 1 },
        assets: [
          { id: "DR-789C-01", type: "Dry Riser", location: "Stair 1", status: "FAULTY", contractor: "SafeFlow Engineering" },
          { id: "DR-789C-02", type: "Dry Riser", location: "Stair 2", status: "OK", contractor: "SafeFlow Engineering" },
          { id: "FH-789C-01", type: "Fire Hose Reel", location: "L6 Lobby", status: "OK", contractor: "MetroFire Services" },
          { id: "FH-789C-02", type: "Fire Hose Reel", location: "L9 Lobby", status: "DUE", contractor: "MetroFire Services" },
          { id: "FH-789C-03", type: "Fire Hose Reel", location: "L12 Lobby", status: "OK", contractor: "MetroFire Services" },
          { id: "FH-789C-04", type: "Fire Hose Reel", location: "L15 Lobby", status: "OK", contractor: "MetroFire Services" }
        ]
      }
    ];

    const statusColors = { ok: 'green', warning: 'orange', faulty: 'red' };
    let markers = [];

    function renderMarkers(filter = 'all') {
      markers.forEach(m => map.removeLayer(m));
      markers = [];

      blocks.forEach(block => {
        const include =
          filter === 'all' ||
          (filter === 'dry' && block.summary.dry > 0) ||
          (filter === 'hose' && block.summary.hose > 0);
        if (!include) return;

        const marker = L.circleMarker([block.lat, block.lng], { color: statusColors[block.status], radius: 10, fillOpacity: 0.8 }).addTo(map);

        marker.on('click', () => {
          const rows = block.assets.map(a => `
            <tr class='border-b border-slate-600'>
              <td class='py-1 pr-2'>${a.id}</td>
              <td class='py-1 pr-2'>${a.type}</td>
              <td class='py-1 pr-2'>${a.location}</td>
              <td class='py-1 pr-2'>${a.status}</td>
              <td class='py-1'>${a.contractor}</td>
            </tr>
          `).join('');

          document.getElementById('block-info').innerHTML = `
            <div>
              <div class='flex items-center justify-between'>
                <h3 class='text-lg font-semibold text-white'>Block ${block.id}</h3>
                <span class='badge'>${block.townCouncil}</span>
              </div>
              <p class='text-sm text-slate-300 mt-1'>Status: <span style='color:${statusColors[block.status]}; font-weight:700;'>${block.status.toUpperCase()}</span></p>

              <div class='mt-3 grid grid-cols-2 gap-2 text-sm text-slate-200'>
                <div>Dry Risers: ${block.summary.dry}</div>
                <div>Hose Reels: ${block.summary.hose}</div>
                <div>Faulty Assets: <span class='text-red-400'>${block.summary.faulty}</span></div>
                <div>Due for Check: <span class='text-yellow-300'>${block.summary.due}</span></div>
              </div>

              <div class='mt-4'>
                <h4 class='text-sm font-semibold mb-2 text-slate-200'>Assets & Contractors</h4>
                <div class='overflow-x-auto rounded-lg border border-slate-700'>
                  <table class='min-w-full text-left text-sm'>
                    <thead class='bg-slate-800 text-slate-300'>
                      <tr>
                        <th class='py-2 px-2'>Asset ID</th>
                        <th class='py-2 px-2'>Type</th>
                        <th class='py-2 px-2'>Location</th>
                        <th class='py-2 px-2'>Status</th>
                        <th class='py-2 px-2'>Contractor</th>
                      </tr>
                    </thead>
                    <tbody class='bg-slate-900'>${rows}</tbody>
                  </table>
                </div>
              </div>
            </div>
          `;
        });

        markers.push(marker);
      });
    }

    document.getElementById('asset-filter').addEventListener('change', (e) => renderMarkers(e.target.value));
    renderMarkers();
  </script>
</body>
</html>
